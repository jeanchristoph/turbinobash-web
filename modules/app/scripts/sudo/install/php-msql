curl -s https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -
curl -s https://packages.microsoft.com/config/debian/10/prod.list >/etc/apt/sources.list.d/mssql-release.list

apt -y update
ACCEPT_EULA=Y apt -y install msodbcsql17 mssql-tools unixodbc-dev gcc g++ make autoconf libc-dev pkg-config odbcinst odbcinst1debian2 unixodbc

apt -y install php-pear php7.4-dev

update-alternatives --set php /usr/bin/php7.4
update-alternatives --set phar /usr/bin/phar7.4
update-alternatives --set phar.phar /usr/bin/phar.phar7.4
update-alternatives --set phpize /usr/bin/phpize7.4
update-alternatives --set php-config /usr/bin/php-config7.4

echo "# libltdl.la - a libtool library file
# Generated by libtool (GNU libtool) 2.4.2 Debian-2.4.2-1.11+b1
#
# Please DO NOT delete this file!
# It is necessary for linking the library.

# The name that we can dlopen(3).
dlname='libltdl.so.7'

# Names of this library.
library_names='libltdl.so.7.3.0 libltdl.so.7 libltdl.so'

# The name of the static archive.
old_library='libltdl.a'

# Linker flags that can not go in dependency_libs.
inherited_linker_flags=''

# Libraries that this one depends upon.
dependency_libs=' -ldl'

# Names of additional weak libraries provided by this library
weak_library_names=''

# Version information for libltdl.
current=10
age=3
revision=0

# Is this an already installed library?
installed=yes

# Should we warn about portability when linking against -modules?
shouldnotlink=no

# Files to dlopen/dlpreopen
dlopen=''
dlpreopen=''

# Directory that this library needs to be installed in:
libdir='/usr/lib/x86_64-linux-gnu'
" >/usr/lib/x86_64-linux-gnu/libltdl.la

pecl install -f sqlsrv-5.10.1
pecl install -f pdo_sqlsrv-5.10.1
# recuperer le contenu de libltdl.la ici: https://www.apt-browse.org/browse/debian/jessie/main/amd64/libltdl-dev/2.4.2-1.11+b1/file/usr/lib/x86_64-linux-gnu/libltdl.la
# nano /usr/lib/x86_64-linux-gnu/libltdl.la

echo "extension=sqlsrv.so" | tee /etc/php/7.4/mods-available/sqlsrv.ini
echo "extension=pdo_sqlsrv.so" | tee /etc/php/7.4/mods-available/pdo_sqlsrv.ini
phpenmod sqlsrv pdo_sqlsrv
